{"version":3,"sources":["make-webpack.config.js"],"names":[],"mappings":"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","file":"make-webpack.config-compiled.js","sourcesContent":["// @see http://christianalfoni.github.io/javascript/2014/12/13/did-you-know-webpack-and-react-is-awesome.html\n// @see https://github.com/webpack/react-starter/blob/master/make-webpack-config.js\n'use strict';\nvar path = require('path');\nvar fs = require('fs');\n\nvar webpack = require('webpack');\nvar _ = require('lodash');\n\nvar ExtractTextPlugin = require('extract-text-webpack-plugin');\nvar HtmlWebpackPlugin = require('html-webpack-plugin');\n\nvar UglifyJsPlugin = webpack.optimize.UglifyJsPlugin;\nvar CommonsChunkPlugin = webpack.optimize.CommonsChunkPlugin;\n\nvar srcDir = path.resolve(process.cwd(), 'src');\nvar assets = 'assets/';\nvar sourceMap = require('./src/sourcemap.json');\n\nvar excludeFromStats = [\n    /node_modules[\\\\\\/]/\n];\n\nfunction makeConf(options) {\n    options = options || {};\n\n    var debug = options.debug !== undefined ? options.debug : true;\n    var entries = genEntries();\n    var chunks = Object.keys(entries);\n    var config = {\n        entry: entries,\n\n        output: {\n            // 在debug模式下，__build目录是虚拟的，webpack的dev server存储在内存里\n            path: path.resolve(debug ? '__build' : assets),\n            filename: debug ? '[name].js' : 'js/[chunkhash:8].[name].min.js',\n            chunkFilename: debug ? '[chunkhash:8].chunk.js' : 'js/[chunkhash:8].chunk.min.js',\n            hotUpdateChunkFilename: debug ? '[id].[chunkhash:8].js' : 'js/[id].[chunkhash:8].min.js',\n            publicPath: debug ? '/__build/' : ''\n        },\n\n        resolve: {\n            root: [srcDir, './node_modules'],\n            alias: sourceMap,\n            extensions: ['', '.js', '.css', '.scss', '.tpl', '.png', '.jpg']\n        },\n\n        resolveLoader: {\n            root: path.join(__dirname, 'node_modules')\n        },\n\n        module: {\n            noParse: ['jquery'],\n            loaders: [\n                {\n                    test: /\\.(jpe?g|png|gif|svg)$/i,\n                    loaders: [\n                        'image?{bypassOnDebug: true, progressive:true, \\\n                            optimizationLevel: 3, pngquant:{quality: \"65-80\", speed: 4}}',\n                        // url-loader更好用，小于10KB的图片会自动转成dataUrl，\n                        // 否则则调用file-loader，参数直接传入\n                        //'url?limit=51200&name=img/[hash:8].[name].[ext]',\n                        'url?limit=51200&name=img/[hash:8].[name].[ext]',\n                    ]\n                },\n                {\n                    test: /\\.(woff|eot|ttf)$/i,\n                    loader: 'url?limit=10000&name=fonts/[hash:8].[name].[ext]'\n                },\n                {test: /\\.(tpl|ejs)$/, loader: 'ejs'},\n                //{test: /\\.js$/, exclude: /node_modules/, loader: 'jsx'}\n                {test: /\\.js$/, exclude: /node_modules/, loader: 'jsx',query: {\n                    presets: ['es2015']\n                }}\n            ]\n        },\n\n        plugins: [\n            //new CommonsChunkPlugin({\n            //   name: 'common',\n            //   chunks: chunks,\n            //   // Modules must be shared between all entries\n            //   minChunks: chunks.length // 提取所有chunks共同依赖的模块\n            //}),\n            //new CommonsChunkPlugin({\n            //    name: 'common-bc',\n            //    chunks: chunks,\n            //    minChunks: chunks.length\n            //})\n\n            //new CommonsChunkPlugin({\n            //    name: 'common-bc',\n            //    chunks: ['vendors', 'b', 'c'],\n            //    minChunks: 2\n            //})\n        ],\n\n        devServer: {\n            stats: {\n                cached: false,\n                exclude: excludeFromStats,\n                colors: true\n            }\n        }\n    };\n\n    if (debug) {\n        // 开发阶段，css直接内嵌\n        var cssLoader = {\n            test: /\\.css$/,\n            loader: 'style!css'\n        };\n        var sassLoader = {\n            test: /\\.scss$/,\n            loader: 'style!css!sass'\n        };\n\n        config.module.loaders.push(cssLoader);\n        config.module.loaders.push(sassLoader);\n    } else {\n        // 编译阶段，css分离出来单独引入\n        var cssLoader = {\n            test: /\\.css$/,\n            loader: ExtractTextPlugin.extract('style', 'css?minimize') // enable minimize\n        };\n        var sassLoader = {\n            test: /\\.scss$/,\n            loader: ExtractTextPlugin.extract('style', 'css?minimize', 'sass')\n        };\n\n        config.module.loaders.push(cssLoader);\n        config.module.loaders.push(sassLoader);\n        config.plugins.push(\n            //new ExtractTextPlugin('css/[contenthash:8].[name].min.css', {\n            new ExtractTextPlugin('[contenthash:8].[name].min.css', {\n                // 当allChunks指定为false时，css loader必须指定怎么处理\n                // additional chunk所依赖的css，即指定`ExtractTextPlugin.extract()`\n                // 第一个参数`notExtractLoader`，一般是使用style-loader\n                // @see https://github.com/webpack/extract-text-webpack-plugin\n                allChunks: false\n            })\n        );\n\n        // 自动生成入口文件，入口js名必须和入口文件名相同\n        // 例如，a页的入口文件是a.html，那么在js目录下必须有一个a.js作为入口文件\n        var pages = fs.readdirSync(srcDir);\n\n        pages.forEach(function (filename) {\n            var m = filename.match(/(.+)\\.html$/);\n\n            if (m) {\n                // @see https://github.com/kangax/html-minifier\n                var conf = {\n                    template: path.resolve(srcDir, filename),\n                    // @see https://github.com/kangax/html-minifier\n                    // minify: {\n                    //     collapseWhitespace: true,\n                    //     removeComments: true\n                    // },\n                    filename: filename\n                };\n\n                if (m[1] in config.entry) {\n                    conf.inject = 'body';\n                    conf.chunks = ['common', m[1]];\n                }\n\n                config.plugins.push(new HtmlWebpackPlugin(conf));\n            }\n        });\n\n        // config.plugins.push(new UglifyJsPlugin());\n    }\n\n    return config;\n}\n\nfunction genEntries() {\n    var jsDir = path.resolve(srcDir, 'js');\n    var names = fs.readdirSync(jsDir);\n    var map = {};\n\n    names.forEach(function (name) {\n        var m = name.match(/(.+)\\.js$/);\n        var entry = m ? m[1] : '';\n        var entryPath = entry ? path.resolve(jsDir, name) : '';\n\n        if (entry) map[entry] = entryPath;\n    });\n\n    return map;\n}\n\nmodule.exports = makeConf;\n"]}