define(function(t){function e(t){var e=new Date;return e.setTime(t),e.Format("yyyy-MM-dd")}t("laydate"),Date.prototype.Format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in e)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[a]:("00"+e[a]).substr((""+e[a]).length)));return t},$.get("/vip/getAccount.do",function(t){"0000000"==t.rtnCode?$(".account-tel").text(t.bizData.account):console.log(t.msg)}),$.get("/info/getUserInfo.do",function(t){if("0000000"==t.rtnCode){var n,i=t.bizData;n=""==i.icon||null==i.icon?"/static/dist/common/images/icon_default.png":i.icon,console.log(t),$(".avatar-img").attr("src",n),$(".avatar-box").show(),$(".name").attr("value",i.name),$(".school").attr("value",i.schoolName),$(".birthdayDate").attr("value",e(i.birthdayDate)),$(".sex").attr("value",i.sex),$(".subject").attr("value",i.subjectType),$(".mail").attr("value",i.mail),$(".qq").attr("value",i.qq),1==i.sex?$("#sex_m").attr("checked",!0):$("#sex_w").attr("checked",!0),1==i.subjectType?$("#subject_l").attr("checked",!0):$("#subject_w").attr("checked",!0),a.init(i),a.addEventForArea()}else alert(t.msg)}),$(".content").fadeIn();var a={data:[],init:function(t){var e=this;$.get("/region/getAllRegion.do",function(a){"0000000"===a.rtnCode&&(e.data=a.bizData,$("#cmbProvince").html(e.render(e.data,!0)),t.provinceId&&($("#cmbProvince").val(t.provinceId),e.changeProvince(t.provinceId),$("#cmbCity").val(t.cityId),e.changeCity(t.cityId),$("#cmbArea").val(t.countyId)))})},render:function(t,e){var a=[];return e&&a.push("<option>请选择...</option>"),$.each(t,function(t,e){a.push('<option value="'+e.id+'">'+e.name+"</option>")}),a.join("")},changeProvince:function(t){if(t){var e=this.getCity(t);e&&e.length>0?($("#cmbCity").html(this.render(e)),this.changeCity(e[0].id)):$("#cmbCity").html("<option>请选择...</option>")}},changeCity:function(t){var e=$("#cmbProvince").val();if(t&&e){var a=this.getCounty(e,t);a&&a.length>0?$("#cmbArea").html(this.render(a)):$("#cmbArea").html("<option>请选择...</option>")}},addEventForArea:function(){var t=this;$("#cmbProvince").change(function(e){var a=this.value;t.changeProvince(a)}),$("#cmbCity").change(function(e){var a=this.value;t.changeCity(a)})},getCity:function(t){for(var e=0,a=this.data.length;a>e;e++)if(this.data[e].id==t)return this.data[e].cityList},getCounty:function(t,e){for(var a=0,n=this.data.length;n>a;a++)if(this.data[a].id==t){var i=this.data[a].cityList;if(i.length<=0)return null;for(var r=0,o=i.length;o>r;r++)if(i[r].id==e)return i[r].countyList}}};setTimeout(function(){var t=["-100","-110","-120","-130"],e=["文件数量不能超过(5)","文件超过大小限制(10MB)","零字节的文件","无效的文件类型"];$("#uploadify").uploadify({swf:"/static/bower_components/uploadify/uploadify.swf",fileObjName:"file",uploader:"http://pre.file.xy189.cn/file/upload/savefile.shtml",auto:!0,removeTimeout:0,multi:!1,uploadLimit:0,fileSizeLimit:"10MB",fileTypeDesc:"图片文件(*.jpg;*.png;*.gif;*.jpeg)",buttonText:"点击上传",fileTypeExts:"*.jpg;*.png;*.gif;*.jpeg",progressData:"percentage",speed:"percentage",queueSizeLimit:5,removeCompleted:!0,onSelect:function(t){this.queueData.filesErrored=0},onOpen:function(t,e,a){},onSelectError:function(a,n,i){for(var r=0;r<t.length;r++)t[r]==n&&(this.queueData.errorMsg=e[r])},onCancel:function(t){},onFallback:function(){alert("浏览器不能兼容Flash,请下载最新版!")},onClearQueue:function(t){},onUploadStart:function(t){},onUploadSuccess:function(t,e,a){console.log(e);var n=JSON.parse(e),e={userIcon:n.data.url};$(".avatar-img").attr("src",n.data.url);var i=this.wrapper.selector;$(i).uploadify("settings","buttonText","正在加载"),$("img[data-icon]").each(function(){$(this).attr("src",n.data.url+"!100?t="+(new Date).getTime())}),$(i).uploadify("settings","buttonText","换一个")},onUploadError:function(t,e,a,n){switch(a){case"400":$("#"+t.id).find(".data").html(" - 上传失败，文件超过大小限制(2MB)");break;case"401":$("#"+t.id).find(".data").html(" - 上传失败，零字节的文件");break;case"402":$("#"+t.id).find(".data").html(" - 上传失败，无效的文件类型");break;case"500":$("#"+t.id).find(".data").html(" - 上传失败，服务器问题")}},onDialogClose:function(t){}})},10),$(".btn-submit").click(function(){var t=$('input[name="sex"]:checked').val(),e=$('input[name="subject"]:checked').val(),a=$(".school").val(),n=$(".birthdayDate").val(),i=Date.parse(new Date(n))/1e3,r=$(".name").val().trim();if(0==r.length)return $(".error-tips").text("用户名不能为空").fadeIn(),!1;if(r.length>10)return $(".error-tips").text("用户名不能大于10个字").fadeIn(),!1;if(r.length>20)return $(".error-tips").text("学校名不能大于20个字").fadeIn(),!1;var o=$(".qq").val().trim(),c=$(".mail").val().trim();if(0!=o.length||0!=c.length){var s=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;if(!s.test(c))return $(".error-tips").text("邮箱填写有误").fadeIn(),!1;var l=/^\s*[.0-9]{5,11}\s*$/;if(!l.test(o)||o.length>20)return $(".error-tips").text("QQ号码输入有误").fadeIn(),!1}var u=$(".avatar-img ").attr("src");$.ajax({url:"/info/updateUserInfo.do",dataType:"json",type:"post",data:{name:r,provinceId:$("#cmbProvince").val(),cityId:$("#cmbCity").val(),countyId:$("#cmbArea").val(),schoolName:a,sex:t,birthdayDate:i,subjectType:e,mail:c,icon:u,qq:o},success:function(t){"0000000"==t.rtnCode?($(".user-avatar").attr("src",u),$(".error-tips").text("信息更新成功").fadeIn(1e3).fadeOut(2e3)):$(".content").text(t.msg)}})})});