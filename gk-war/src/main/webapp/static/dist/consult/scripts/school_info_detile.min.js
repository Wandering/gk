define(function(t){function e(t){var e=new RegExp("(^|\\?|&)"+t+"=([^&]*)(\\s|&|$)","i");return e.test(window.location.href)?unescape(RegExp.$2.replace(/\+/g," ")):""}var l=t("$");t("swiper");var a={getBasicInfo:function(t){var e=this;l.ajax({type:"post",url:"/university/getUniversityDetail.do",contentType:"application/x-www-form-urlencoded;charset=utf-8",data:{code:t},dataType:"json",success:function(t){"0000000"===t.rtnCode&&e.renderInfo(t.bizData)},error:function(t){}})},renderInfo:function(t){l("#info_content").html('<img class="fl" src="'+t.universityImage+'" /><div class="info"><ul><li class="school-name">'+t.name+"</li><li>所在省份："+t.provinceName+"</li><li>院校隶属："+t.subjection+"</li><li>学历层次："+t.educatLevel+"</li><li>院校特征："+t.property+"</li><li>院校类型："+t.universityType+'</li><li>院校网址：<a href="'+t.url+'">'+t.url+"</a></li><li>院校地址："+t.address+"</li><li>联系电话：<span>"+t.contactPhone+"</span></li></ul></div>")},getSchoolInfo:function(t){var e=this;l.ajax({type:"post",url:"/university/getEnrollInfo.do",contentType:"application/x-www-form-urlencoded;charset=utf-8",data:{code:t},dataType:"json",success:function(t){"0000000"===t.rtnCode&&e.renderSchool(t.bizData.enrollInfo)},error:function(t){}})},renderSchool:function(t){for(var e=[],a=[],n=0,i=t.length;i>n;n++){e.push("<li>"+t[n].title+"</li>");var o=t[n].infos;a.push('<div style="display:none" class="school-table mt20" id="school_table_'+n+'"><table border="0" cellpadding="0" cellspacing="0"><thead><tr><th></th><th>计划数</th><th>录取数</th><th>最高分</th><th>最高位次</th><th>最低分</th><th>最低位次</th><th>平均分</th><th>平均分位次</th></tr></thead><tbody>');for(var s=0,r=o.length;r>s;s++)a.push("<tr><td>"+o[s].subjectName+"</td><td>"+o[s].planNumber+"</td><td>"+o[s].enrollNumber+"</td><td>"+o[s].highestScore+"</td><td>"+o[s].highestRank+"</td><td>"+o[s].lowestScore+"</td><td>"+o[s].lowestRank+"</td><td>"+o[s].averageScore+"</td><td>"+o[s].averageRank+"</td></tr>");a.push("</tbody></table></div>")}l("#tabs_list_last").html(e.join("")),l("#last_content").html(a.join("")),l("#tabs_list_last li").first().addClass("active"),l("#school_table_0").show(),this.addSchoolEventHandle()},addSchoolEventHandle:function(){l("#tabs_list_last li").on("mouseover",function(){l(this).hasClass("active")||(l(this).addClass("active").siblings().removeClass("active"),l("#school_table_"+l(this).index()).show().siblings().hide())})},getEnroll:function(t){var e=this;l.ajax({type:"post",url:"/university/getEnrollPlan.do",contentType:"application/x-www-form-urlencoded;charset=utf-8",data:{code:t},dataType:"json",success:function(t){"0000000"===t.rtnCode&&e.renderEnroll(t.bizData)},error:function(t){}})},renderEnrollTable:function(t){var e=[];e.push('<table border="0" cellpadding="0" cellspacing="0"><thead><tr><th>专业名称</th><th>批次</th><th>科类</th><th>计划人数</th><th>学制</th><th>收费标准</th></tr></thead><tbody>');for(var l=0,a=t.length;a>l;l++)e.push("<tr><td>"+(t[l].majoredName||"")+"</td><td>"+(t[l].batch||"")+"</td><td>"+(t[l].subject||"")+"</td><td>"+(t[l].planNumber||"")+"</td><td>"+(t[l].schoolLength||"")+"</td><td>"+(t[l].feeStandard||"")+"</td></tr>");return e.push("</tbody></table>"),e.join("")},renderEnroll:function(t){for(var e=t.enrollPlan,a=[],n=[],i=0,o=e.length;o>i;i++){var s="enrollData"+i;a.push('<li data-saveData="'+s+'">'+e[i].title+"</li>");var r=e[i].planInfos;this[s]=r,n.push('<div style="display:none" class="school-table mt20" id="enroll_table_'+i+'">'),n.push(this.renderEnrollTable(r)),n.push("</div>")}a.push("<li>招生章程</li>"),n.push('<div style="display:none" class="school-table mt20" id="enroll_table_'+i+'">'+t.entroIntro+"</div>"),i++,a.push("<li>院校简介</li>"),n.push('<div style="display:none" class="school-table mt20" id="enroll_table_'+i+'">'+t.universityIntro+"</div>"),l("#tabs_list_enroll").html(a.join("")),l("#enroll_content").html(n.join("")),l("#tabs_list_enroll li").first().addClass("active");var d=l("#tabs_list_enroll li.active").text();this.setCategory(d),l("#enroll_table_0").show(),this.addEnrollEventHandle(),this.categoryHandle()},addEnrollEventHandle:function(){var t=this;l("#tabs_list_enroll li").on("mouseover",function(){if(!l(this).hasClass("fr")&&!l(this).hasClass("active")){l(this).addClass("active").siblings().removeClass("active");var e=l(this).text(),a=l(this).index();t.setCategory(e,l(this)),l("#enroll_table_"+a).show().siblings().hide()}})},setCategory:function(t,e){if("招生章程"===t||"院校简介"===t)l("#category").hide();else{if(l("#category button").removeClass("active"),e){var a=e.attr("data-categoryId");a&&l('#category button[data-id="'+a+'"]').addClass("active")}l("#category").show()}},categoryHandle:function(){var t=this;l("#category button").on("click",function(e){l(this).addClass("active").siblings().removeClass("active"),l("#tabs_list_enroll li.active").attr("data-categoryId",l(this).attr("data-id"));var a=l(this).text();t.filterEnroll(a,l("#tabs_list_enroll li.active").index())})},filterEnroll:function(t,e){for(var a=this["enrollData"+e],n=[],i=0;i<a.length;i++)t===a[i].subject&&n.push(a[i]);n.length>0?l("#enroll_table_"+e).html(this.renderEnrollTable(n)):l("#enroll_table_"+e).html('<p style="padding: 20px 0; text-align: center">没有符合相关的信息！</p>')}};l(document).ready(function(){var t=e("id");a.getBasicInfo(t),a.getSchoolInfo(t),a.getEnroll(t)})});