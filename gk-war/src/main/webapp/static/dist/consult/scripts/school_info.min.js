define(function(a){var t=a("$");a("swiper");var e={curPage:1,totalPage:0,render:function(a,e){var s=[],i=0,r=e.length;for("universityFeature"!==a&&s.push('<a class="active" id="0">全部</a>');r>i;i++)s.push('<a id="'+e[i].id+'">'+e[i].name+"</a>");t("#"+a).html(s.join(""))},show:function(a,t){this.render(a,t),this.addEventForOption()},getData:function(){var a=this;t.get("/university/getInitInfo.do",function(e){"0000000"===e.rtnCode&&(t.each(["provinces","universityType","universityBatch","universityFeature"],function(t,s){a.show(s,e.bizData[s])}),a.getSchoolList(1))})},addEventForOption:function(){var a=this;t(".options a").on("click",function(e){var s=t(this).parent().attr("id");"universityFeature"===s?(t(this).toggleClass("active"),a.getSchoolList(1)):t(this).hasClass("active")||(t(this).addClass("active").siblings().removeClass("active"),a.getSchoolList(1))})},renderSchool:function(a){var e=[],s=0,i=a.length;for(e.push('<table border="0" cellpadding="0" cellspacing="0"><thead><tr><th class="name">院校名称</th><th>所在地区</th><th>院校类型</th><th>院校隶属</th><th>院校特征</th><th>院校信息</th></tr></thead><tbody>');i>s;s++){var r=s%2!=0?"active":"";e.push('<tr class="'+r+'"><td class="name">'+(a[s].name||"")+"</td><td>"+(a[s].provinceName||"")+"</td><td>"+(a[s].universityType||"")+"</td><td>"+(a[s].subjection||"")+"</td><td>"+(a[s].property||"")+'</td><td><a target="_blank" href="/consult/school_detile.jsp?id='+a[s].code+'">查看详情</a></td></tr>')}e.push("</tbody></table>"),t("#school_list").html(e.join(""))},getSchoolList:function(a){var e=t("#provinces a.active").attr("id"),s=t("#provinces a.active").text();"全部"===s&&(s="");var i=t("#universityType a.active").attr("id"),r=t("#universityType a.active").text();"全部"===r&&(r="");var n=t("#universityBatch a.active").attr("id"),c=t("#universityBatch a.active").text();"全部"===c&&(c="");var o=[];t.each(t("#universityFeature a.active"),function(a,e){o.push(t(e).attr("id"))});var h=o.join(",")||0,u=[];t.each(t("#universityFeature a.active"),function(a,e){u.push(t(e).text())});var l=u.join(","),g=t("#school_serach").val(),v=this;t.ajax({type:"post",url:"/university/getUniversityList.do",contentType:"application/x-www-form-urlencoded;charset=utf-8",data:{provinceId:e,provinceName:s,universityTypeId:i,universityTypeName:r,universityBatchId:n,universityBatchName:c,universityFeatureId:h,universityFeatureName:l,pageSize:10,pageNo:a,searchName:g},dataType:"json",success:function(e){if("0000000"===e.rtnCode){var s=e.bizData.list;s&&s.length?(v.renderSchool(s),1==a&&v.renderPage(1,e.bizData.count)):(t("#school_list").html('<p style="text-align: center">暂无信息！</p>'),t("#page").html(""))}},error:function(a){}})},renderPage:function(a,e){this.totalPage=Math.ceil(e/10);var s=[],i=10*(a-1)+1;s.push('<span class="record">共'+e+'条记录 <span class="startNum">'+i+"</span>/"+e+"</span>"),s.push('<a class="previous-page">上一页</a>');for(var r=this.totalPage>10?10:this.totalPage,n=0;r>n;n++){var c=n+1;a==c?s.push('<a class="active '+c+'">'+c+"</a>"):s.push('<a class="'+c+'">'+c+"</a>")}r!=this.totalPage&&s.push("<span>...</span>"),s.push('<a class="next-page">下一页</a>'),t("#page").html(s.join("")),this.pageEventHandle()},refreshPageShow:function(a){var t=a+2;t=t>this.totalPage?this.totalPage:t;var e=this.totalPage>10?10:this.totalPage;t=e>t?e:t;var s=t;console.log(t);for(var i=[],r=0;10>r;r++)i.push(t--);return i.reverse(),s>10&&(i[0]=1,i[1]=2,i[2]="..."),s<=this.totalPage-2&&i.push("..."),i},refreshPage:function(a){var e=this.refreshPageShow(a),s=[];s.push('<a class="previous-page">上一页</a>');for(var i=0;i<e.length;i++)"string"==typeof e[i]?s.push("<span>...</span>"):s.push('<a class="'+e[i]+'">'+e[i]+"</a>");s.push('<a class="next-page">下一页</a>'),t("#page").html(s.join("")),this.pageEventHandle()},pageEventHandle:function(){var a=this;t("#page a").on("click",function(e){if(t(this).hasClass("previous-page")){if(a.curPage--,a.curPage>0){!t("#page a."+a.curPage)[0]&&this.totalPage>10&&a.refreshPage(a.curPage),t("#page a."+a.curPage).addClass("active").siblings().removeClass("active");var s=10*(a.curPage-1)+1;t(".startNum").text(s),a.getSchoolList(a.curPage)}}else if(t(this).hasClass("next-page")){if(a.curPage++,a.curPage<=a.totalPage){!t("#page a."+a.curPage)[0]&&this.totalPage>10&&a.refreshPage(a.curPage),t("#page a."+a.curPage).addClass("active").siblings().removeClass("active");var s=10*(a.curPage-1)+1;t(".startNum").text(s),a.getSchoolList(a.curPage)}}else if(!t(this).hasClass("active")){if(a.curPage=parseInt(t(this).text()),t(this).addClass("active").siblings().removeClass("active"),this.totalPage>10){var i=a.curPage+1,r=a.curPage-1;i<=a.totalPage&&r>0&&(t("#page a."+i)[0]&&t("#page a."+r)[0]||(a.refreshPage(a.curPage),t("#page a."+a.curPage).addClass("active")))}if(a.curPage>0&&a.curPage<=a.totalPage){var s=10*(a.curPage-1)+1;t(".startNum").text(s),a.getSchoolList(a.curPage)}}})},getSearch:function(){this.curPage=1,this.getSchoolList(1)}};t(document).ready(function(){e.getData(),t("#search_button").on("click",function(a){var s=t("#school_serach").val();s&&e.getSearch()})})});