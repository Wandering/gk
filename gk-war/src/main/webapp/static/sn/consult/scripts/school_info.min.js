define(function(a){var t=a("$");a("backToTop"),a("swiper");var e={curPage:1,totalPage:0,render:function(a,e){var s=[],i=0,r=e.length;for("universityFeature"!==a&&s.push('<a class="active" id="0">全部</a>');r>i;i++)s.push('<a id="'+e[i].id+'">'+e[i].name+"</a>");t("#"+a).html(s.join(""))},show:function(a,t){this.render(a,t),this.addEventForOption()},getData:function(){var a=this;t.get("/university/getInitInfo.do",function(e){"0000000"===e.rtnCode&&(t.each(["provinces","universityType","universityBatch","universityFeature"],function(t,s){a.show(s,e.bizData[s])}),a.getSchoolList(1))})},addEventForOption:function(){var a=this;t(".options a").on("click",function(e){var s=t(this).parent().attr("id");a.curPage=1,"universityFeature"===s?(t(this).toggleClass("active"),a.getSchoolList(1)):(t(this).hasClass("active")||t(this).addClass("active").siblings().removeClass("active"),a.getSchoolList(1))})},renderSchool:function(a){console.log(a);var e=[],s=0,i=a.length;for(e.push('<table border="0" cellpadding="0" cellspacing="0"><thead><tr><th class="name">院校名称</th><th>所在地区</th><th>院校类型</th><th>院校隶属</th><th>院校特征</th><th>院校信息</th></tr></thead><tbody>');i>s;s++){var r=s%2!=0?"active":"";e.push('<tr class="'+r+'"><td class="name">'+(a[s].name||"")+"</td><td>"+(a[s].provinceName||"")+"</td><td>"+(a[s].universityType||"")+"</td><td>"+(a[s].subjection||"")+"</td><td>"+(a[s].property||"")+'</td><td><a target="_blank" href="/consult/school_detile.jsp?id='+a[s].code+'">查看详情</a></td></tr>')}e.push("</tbody></table>"),t("#school_list").html(e.join(""))},getSchoolList:function(e){var s=t("#provinces a.active").attr("id"),i=t("#provinces a.active").text();"全部"===i&&(i="");var r=t("#universityType a.active").attr("id"),c=t("#universityType a.active").text();"全部"===c&&(c="");var n=t("#universityBatch a.active").attr("id"),o=t("#universityBatch a.active").text();"全部"===o&&(o="");var h=[];t.each(t("#universityFeature a.active"),function(a,e){h.push(t(e).attr("id"))});var u=h.join(",")||0,g=[];t.each(t("#universityFeature a.active"),function(a,e){g.push(t(e).text())});var l=g.join(","),v=t("#school_serach").val(),p=this;t.ajax({type:"get",url:"/university/getUniversityList.do",contentType:"application/x-www-form-urlencoded;charset=utf-8",data:{provinceId:s,provinceName:i,universityTypeId:r,universityTypeName:c,universityBatchId:n,universityBatchName:o,universityFeatureId:u,universityFeatureName:l,pageSize:10,pageNo:e,searchName:v},dataType:"json",success:function(s){if("0000000"===s.rtnCode){var i=s.bizData.list;if(i&&i.length)p.renderSchool(i),1==e&&p.renderPage(1,s.bizData.count);else{var r=a("pageErrorTip");t("#school_list").html(r("暂无相关数据")),t("#page").html(""),t(".record").html("")}}},error:function(a){}})},renderPage:function(a,e){this.totalPage=Math.ceil(e/10);var s=[],i=10*(a-1)+1;t(".record").html("共"+e+"条记录&nbsp;&nbsp;共"+this.totalPage+'页&nbsp;&nbsp;<span class="startNum">'+i+"</span>/"+e),s.push('<a class="previous-page">上一页</a>');for(var r=this.totalPage>10?10:this.totalPage,c=0;r>c;c++){var n=c+1;a==n?s.push('<a class="active '+n+'">'+n+"</a>"):s.push('<a class="'+n+'">'+n+"</a>")}r!=this.totalPage&&s.push("<span>...</span>"),s.push('<a class="next-page">下一页</a>'),t("#page").html(s.join("")),this.pageEventHandle()},refreshPageShow:function(a){var t=a+2;t=t>this.totalPage?this.totalPage:t;var e=this.totalPage>10?10:this.totalPage;t=e>t?e:t;for(var s=t,i=[],r=0;10>r;r++)i.push(t--);return i.reverse(),s>10&&(i[0]=1,i[1]=2,i[2]="..."),s<=this.totalPage-2&&i.push("..."),i},refreshPage:function(a){var e=this.refreshPageShow(a),s=[];s.push('<a class="previous-page">上一页</a>');for(var i=0;i<e.length;i++)"string"==typeof e[i]?s.push("<span>...</span>"):s.push('<a class="'+e[i]+'">'+e[i]+"</a>");s.push('<a class="next-page">下一页</a>'),t("#page").html(s.join("")),this.pageEventHandle()},pageEventHandle:function(){var a=this;t("#page a").off("click"),t("#page a").on("click",function(e){if(t(this).hasClass("previous-page")){if(a.curPage>1&&a.curPage--,a.curPage>0){!t("#page a."+a.curPage)[0]&&a.totalPage>10&&a.refreshPage(a.curPage),t("#page a."+a.curPage).addClass("active").siblings().removeClass("active");var s=10*(a.curPage-1)+1;t(".startNum").text(s),a.getSchoolList(a.curPage)}}else if(t(this).hasClass("next-page")){if(a.curPage<a.totalPage&&a.curPage++,a.curPage<=a.totalPage){!t("#page a."+a.curPage)[0]&&a.totalPage>10&&a.refreshPage(a.curPage),t("#page a."+a.curPage).addClass("active").siblings().removeClass("active");var s=10*(a.curPage-1)+1;t(".startNum").text(s),a.getSchoolList(a.curPage)}}else if(!t(this).hasClass("active")){if(a.curPage=parseInt(t(this).text()),t(this).addClass("active").siblings().removeClass("active"),a.totalPage>10){var i=a.curPage+1,r=a.curPage-1;i<=a.totalPage&&r>0&&(t("#page a."+i)[0]&&t("#page a."+r)[0]||(a.refreshPage(a.curPage),t("#page a."+a.curPage).addClass("active")))}if(a.curPage>0&&a.curPage<=a.totalPage){var s=10*(a.curPage-1)+1;t(".startNum").text(s),a.getSchoolList(a.curPage)}}})},getSearch:function(){this.curPage=1,this.getSchoolList(1)}};t(document).ready(function(){e.getData(),t("#search_button").on("click",function(a){var s=t("#school_serach").val();s&&e.getSearch()}),t("#school_serach").keydown(function(a){if(13==a.keyCode){var s=t("#school_serach").val();s&&e.getSearch()}})})});