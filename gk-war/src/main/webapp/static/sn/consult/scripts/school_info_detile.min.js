define(function(t){function e(t){var e=new RegExp("(^|\\?|&)"+t+"=([^&]*)(\\s|&|$)","i");return e.test(window.location.href)?unescape(RegExp.$2.replace(/\+/g," ")):""}var a=t("$");t("backToTop"),t("swiper");var l={batchData:[],batchName:[],getBasicInfo:function(e){var l=this;a.ajax({type:"get",url:"/university/getUniversityDetail.do",contentType:"application/x-www-form-urlencoded;charset=utf-8",data:{code:e},dataType:"json",success:function(e){if("0000000"===e.rtnCode)l.renderInfo(e.bizData);else{var n=t("pageErrorTip");a("#info_content").html(n("数据维护中"))}},error:function(e){var l=t("pageErrorTip");a("#info_content").html(l("数据维护中"))}})},renderInfo:function(t){var e="院校地址："+(t.address||""),l="";e.length>17&&(l="integet-line");var n="联系电话："+(t.contactPhone||""),i="";n.length>16&&(i="integet-line");var s="院校网址："+(t.url||""),o="";console.log(s.length),s.length>20&&(o="integet-line"),a("#info_content").html('<img class="fl" src="'+(t.universityImage||"/static/src/common/images/kqbk_banner_default.png")+'" /><div class="info"><ul><li class="school-name">'+(t.name||"")+"</li><li>所在省份："+(t.provinceName||"")+"</li><li>院校隶属："+(t.subjection||"")+"</li><li>学历层次："+(t.educatLevel||"")+"</li><li>院校特征："+(t.property||"")+"</li><li>院校类型："+(t.universityType||"")+'</li><li class="'+o+'">院校网址：<a class="website" target="_blank" href="'+t.url+'">'+(t.url||"")+'</a></li><li class="'+l+'">'+e+'</li><li class="'+i+'">联系电话：<span>'+(t.contactPhone||"")+"</span></li></ul></div>")},getSchoolInfo:function(t){var e=this;a.ajax({type:"get",url:"/university/getEnrollInfo.do",contentType:"application/x-www-form-urlencoded;charset=utf-8",data:{code:t},dataType:"json",success:function(t){"0000000"===t.rtnCode&&e.renderSchool(t.bizData.enrollInfo)},error:function(t){}})},renderSchool:function(t){this.batchData=t;for(var e=[],l=[],n=0,i=t.length;i>n;n++){var s=[];if(t[n].title.indexOf("年")){var o=t[n].title.substring(0,4);e.push("<li>"+t[n].title.replace(o,o+"年")+"</li>")}else e.push("<li>"+t[n].title+"</li>");var r=t[n].infos;l.push('<div style="display:none" class="school-table mt20" id="school_table_'+n+'"><table border="0" cellpadding="0" cellspacing="0"><thead><tr><th></th><th>计划数</th><th>录取数</th><th>最高分</th><th>最高位次</th><th>最低分</th><th>最低位次</th><th>平均分</th><th>平均分位次</th></tr></thead><tbody>');for(var h=0,c=r.length;c>h;h++){var d=s.join("&");d.indexOf(r[h].batch)<0&&s.push(r[h].batch),l.push("<tr><td>"+(r[h].subjectName||"")+"</td><td>"+(r[h].planNumber||"")+"</td><td>"+(r[h].enrollNumber||"")+"</td><td>"+(r[h].highestScore||"")+"</td><td>"+(r[h].highestRank||"")+"</td><td>"+(r[h].lowestScore||"")+"</td><td>"+(r[h].lowestRank||"")+"</td><td>"+(r[h].averageScore||"")+"</td><td>"+(r[h].averageRank||"")+"</td></tr>")}l.push("</tbody></table></div>"),this.batchName.push(s)}a("#tabs_list_last").html(e.join("")),a("#tabs_list_last li").first().addClass("active"),this.renderBatch(this.batchName[0])?(a("#select_batch").html(this.renderBatch(this.batchName[0])),a("#select_batch button").first().addClass("active"),this.getSchoolByBatch(),this.addHandleBatch()):a("#last_content").html(l.join("")),a("#school_table_0").show(),this.addSchoolEventHandle()},addHandleBatch:function(){var t=this;a("#select_batch button").off("click"),a("#select_batch button").on("click",function(e){a(this).addClass("active").siblings().removeClass("active"),t.getSchoolByBatch()})},getSchoolByBatch:function(){for(var t=a("#select_batch button.active").text(),e=[],l=a("#tabs_list_last li.active").index(),n=this.batchData[l].infos,i=0;i<n.length;i++)t===n[i].batch&&e.push(n[i]);var s=[];s.push('<div style="display:none" class="school-table mt20" id="school_table_'+l+'"><table border="0" cellpadding="0" cellspacing="0"><thead><tr><th></th><th>计划数</th><th>录取数</th><th>最高分</th><th>最高位次</th><th>最低分</th><th>最低位次</th><th>平均分</th><th>平均分位次</th></tr></thead><tbody>');for(var o=0,r=e.length;r>o;o++)s.push("<tr><td>"+(e[o].subjectName||"")+"</td><td>"+(e[o].planNumber||"")+"</td><td>"+(e[o].enrollNumber||"")+"</td><td>"+(e[o].highestScore||"")+"</td><td>"+(e[o].highestRank||"")+"</td><td>"+(e[o].lowestScore||"")+"</td><td>"+(e[o].lowestRank||"")+"</td><td>"+(e[o].averageScore||"")+"</td><td>"+(e[o].averageRank||"")+"</td></tr>");s.push("</tbody></table></div>"),a("#last_content").html(s.join("")),a("#school_table_"+l).show()},renderBatch:function(t){if(t.length<2)return"";for(var e=[],a=0;a<t.length;a++)e.push("<button>"+t[a]+"</button>");return e.join("")},addSchoolEventHandle:function(){var t=this;a("#tabs_list_last li").on("mouseover",function(){a(this).hasClass("active")||(a(this).addClass("active").siblings().removeClass("active"),a("#school_table_"+a(this).index()).show().siblings().hide(),t.renderBatch(t.batchName[a(this).index()])&&(a("#select_batch").html(t.renderBatch(t.batchName[a(this).index()])),a("#select_batch button").first().addClass("active"),t.getSchoolByBatch(),t.addHandleBatch()))})},getEnroll:function(t){var l=this,n=e("batch");a.ajax({type:"get",url:"/university/getEnrollPlan.do",contentType:"application/x-www-form-urlencoded;charset=utf-8",data:{code:t,batch:n},dataType:"json",success:function(t){"0000000"===t.rtnCode&&l.renderEnroll(t.bizData)},error:function(t){}})},renderEnrollTable:function(t){var e=[];e.push('<table border="0" cellpadding="0" cellspacing="0"><thead><tr><th  class="name">专业名称</th><th>批次</th><th>科类</th><th>计划人数</th><th>学制</th><th>收费标准</th></tr></thead><tbody>');for(var a=0,l=t.length;l>a;a++)e.push('<tr><td width="50%" class="name">'+(t[a].majoredName||"")+'</td><td width="10%">'+(t[a].batch||"")+'</td><td width="10%">'+(t[a].subject||"")+'</td><td width="10%">'+(t[a].planNumber||"")+'</td><td width="10%">'+(t[a].schoolLength||"")+'</td><td width="10%">'+(t[a].feeStandard||"")+"</td></tr>");return e.push("</tbody></table>"),e.join("")},renderEnroll:function(t){for(var e=t.enrollPlan,l=[],n=[],i=0,s=e.length;s>i;i++){var o="enrollData"+i;l.push('<li data-saveData="'+o+'">'+e[i].title+"</li>");var r=e[i].planInfos;this[o]=r,n.push('<div style="display:none" class="school-table mt20" id="enroll_table_'+i+'">'),n.push(this.renderEnrollTable(r)),n.push("</div>")}l.push("<li>招生章程</li>"),n.push('<div style="display:none" class="school-table mt20" id="enroll_table_'+i+'">'+(t.entroIntro||"")+"</div>"),i++,l.push("<li>院校简介</li>"),n.push('<div style="display:none" class="school-table mt20" id="enroll_table_'+i+'">'+(t.universityIntro||"")+"</div>"),a("#tabs_list_enroll").html(l.join("")),a("#enroll_content").html(n.join("")),a("#tabs_list_enroll li").first().addClass("active");var h=a("#tabs_list_enroll li.active").text();this.setCategory(h),a("#enroll_table_0").show(),this.addEnrollEventHandle(),this.categoryHandle()},addEnrollEventHandle:function(){var t=this;a("#tabs_list_enroll li").on("mouseover",function(){if(!a(this).hasClass("fr")&&!a(this).hasClass("active")){a(this).addClass("active").siblings().removeClass("active");var e=a(this).text(),l=a(this).index();t.setCategory(e,a(this)),a("#enroll_table_"+l).show().siblings().hide()}})},setCategory:function(t,e){if("招生章程"===t||"院校简介"===t)a("#category").hide();else{if(a("#category button").removeClass("active"),e){var l=e.attr("data-categoryId");l&&a('#category button[data-id="'+l+'"]').addClass("active")}a("#category").show()}},categoryHandle:function(){var t=this;a("#category button").on("click",function(e){a(this).addClass("active").siblings().removeClass("active"),a("#tabs_list_enroll li.active").attr("data-categoryId",a(this).attr("data-id"));var l=a(this).text();t.filterEnroll(l,a("#tabs_list_enroll li.active").index())})},filterEnroll:function(t,e){for(var l=this["enrollData"+e],n=[],i=0;i<l.length;i++)t===l[i].subject&&n.push(l[i]);n.length>0?a("#enroll_table_"+e).html(this.renderEnrollTable(n)):a("#enroll_table_"+e).html('<p style="padding: 20px 0; text-align: center">没有符合相关的信息！</p>')}};a(document).ready(function(){var t=e("id");l.getBasicInfo(t),l.getSchoolInfo(t),l.getEnroll(t)})});