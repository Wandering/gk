define(function(t){function e(t){var e=new RegExp("(^|\\?|&)"+t+"=([^&]*)(\\s|&|$)","i");return e.test(window.location.href)?unescape(RegExp.$2.replace(/\+/g," ")):""}function a(t,e){var a=new RegExp(e?t+"=(?:.*?&)*?"+e+"=([^&;$]*)":t+"=([^;$]*)","i");return a.test(unescape(document.cookie))?RegExp.$1:""}var l=t("$");t("backToTop");var n={batchData:[],batchName:[],getBasicInfo:function(e,i){var s=this;l.ajax({type:"get",url:"/university/getUniversityDetail.do?"+e+"="+i,contentType:"application/x-www-form-urlencoded;charset=utf-8",dataType:"json",success:function(e){console.log(e.bizData.id);var i=e.bizData.id;if(a("snuser")&&l.get("/userCollection/isUniversityCollect.do?universityId="+i,function(t){(t.rtnCode="0000000")&&(0==t.bizData?(console.log("没有收藏"),l("#collect").removeClass("active").find("span").text("没有收藏"),l("#info_content").one("click","#collect",function(){l(this);l.get("/userCollection/saveUserCollect.do?universityId="+i,function(t){console.log(t),"0000000"==t.rtnCode&&t.bizData&&(l("#collect").addClass("active").find("span").text("已收藏"),console.log(88))})})):(console.log("已收藏"),l("#collect").addClass("active").find("span").text("已收藏")))}),"0000000"===e.rtnCode)s.renderInfo(e.bizData),n.getEnroll(i),n.getSchoolInfo(i);else{var o=t("pageErrorTip");l("#info_content").html(o("数据维护中"))}},error:function(e){var a=t("pageErrorTip");l("#info_content").html(a("数据维护中"))}})},renderInfo:function(t){var e="院校地址："+(t.address||""),n="";e.length>17&&(n="integet-line");var i="联系电话："+(t.contactPhone||""),s="";i.length>16&&(s="integet-line");var o="院校网址："+(t.url||""),r="";o.length>20&&(r="integet-line");var c="";a("snuser")&&'""'!=a("snuser")?c="javascript:;":(console.log("没有登录111"),c="/login/login.jsp"),l("#info_content").html('<a href="'+c+'" id="collect" class="collect"><span>没有收藏</span><i></i></a><img class="fl" src="'+(t.universityImage||"http://cdn.gaokao360.net/static/global/common/images/kqbk_banner_default.png")+'" /><div class="info"><ul><li class="school-name">'+(t.name||"")+"</li><li>所在省份："+(t.provinceName||"")+"</li><li>院校隶属："+(t.subjection||"")+"</li><li>学历层次："+(t.educatLevel||"")+"</li><li>院校特征："+(t.property||"")+"</li><li>院校类型："+(t.universityType||"")+'</li><li class="'+r+'">院校网址：<a class="website" target="_blank" href="'+t.url+'">'+(t.url||"")+'</a></li><li class="'+n+'">'+e+'</li><li class="'+s+'">联系电话：<span>'+(t.contactPhone||"")+"</span></li></ul></div>")},getSchoolInfo:function(t){var e=this;l.ajax({type:"get",url:"/university/getEnrollInfo.do",contentType:"application/x-www-form-urlencoded;charset=utf-8",data:{id:t},dataType:"json",success:function(t){"0000000"===t.rtnCode&&e.renderSchool(t.bizData.enrollInfo)},error:function(t){}})},renderSchool:function(t){this.batchData=t;for(var e=[],a=[],n=0,i=t.length;i>n;n++){var s=[];if(t[n].title.indexOf("年")){var o=t[n].title.substring(0,4);e.push("<li>"+t[n].title.replace(o,o+"年")+"</li>")}else e.push("<li>"+t[n].title+"</li>");var r=t[n].infos;a.push('<div style="display:none" class="school-table mt20" id="school_table_'+n+'"><table border="0" cellpadding="0" cellspacing="0"><thead><tr><th></th><th>计划数</th><th>录取数</th><th>最高分</th><th>最高位次</th><th>最低分</th><th>最低位次</th><th>平均分</th><th>平均分位次</th></tr></thead><tbody>');for(var c=0,h=r.length;h>c;c++){var d=s.join("&");d.indexOf(r[c].batch)<0&&s.push(r[c].batch),a.push("<tr><td>"+(r[c].subjectName||"")+"</td><td>"+(r[c].planNumber||"")+"</td><td>"+(r[c].enrollNumber||"")+"</td><td>"+(r[c].highestScore||"")+"</td><td>"+(r[c].highestRank||"")+"</td><td>"+(r[c].lowestScore||"")+"</td><td>"+(r[c].lowestRank||"")+"</td><td>"+(r[c].averageScore||"")+"</td><td>"+(r[c].averageRank||"")+"</td></tr>")}a.push("</tbody></table></div>"),this.batchName.push(s)}l("#tabs_list_last").html(e.join("")),l("#tabs_list_last li").first().addClass("active"),this.renderBatch(this.batchName[0])?(l("#select_batch").html(this.renderBatch(this.batchName[0])),l("#select_batch button").first().addClass("active"),this.getSchoolByBatch(),this.addHandleBatch()):l("#last_content").html(a.join("")),l("#school_table_0").show(),this.addSchoolEventHandle()},addHandleBatch:function(){var t=this;l("#select_batch button").off("click"),l("#select_batch button").on("click",function(e){l(this).addClass("active").siblings().removeClass("active"),t.getSchoolByBatch()})},getSchoolByBatch:function(){for(var t=l("#select_batch button.active").text(),e=[],a=l("#tabs_list_last li.active").index(),n=this.batchData[a].infos,i=0;i<n.length;i++)t===n[i].batch&&e.push(n[i]);var s=[];s.push('<div style="display:none" class="school-table mt20" id="school_table_'+a+'"><table border="0" cellpadding="0" cellspacing="0"><thead><tr><th></th><th>计划数</th><th>录取数</th><th>最高分</th><th>最高位次</th><th>最低分</th><th>最低位次</th><th>平均分</th><th>平均分位次</th></tr></thead><tbody>');for(var o=0,r=e.length;r>o;o++)s.push("<tr><td>"+(e[o].subjectName||"")+"</td><td>"+(e[o].planNumber||"")+"</td><td>"+(e[o].enrollNumber||"")+"</td><td>"+(e[o].highestScore||"")+"</td><td>"+(e[o].highestRank||"")+"</td><td>"+(e[o].lowestScore||"")+"</td><td>"+(e[o].lowestRank||"")+"</td><td>"+(e[o].averageScore||"")+"</td><td>"+(e[o].averageRank||"")+"</td></tr>");s.push("</tbody></table></div>"),l("#last_content").html(s.join("")),l("#school_table_"+a).show()},renderBatch:function(t){if(t.length<2)return"";for(var e=[],a=0;a<t.length;a++)e.push("<button>"+t[a]+"</button>");return e.join("")},addSchoolEventHandle:function(){var t=this;l("#tabs_list_last li").on("mouseover",function(){l(this).hasClass("active")||(l(this).addClass("active").siblings().removeClass("active"),l("#school_table_"+l(this).index()).show().siblings().hide(),t.renderBatch(t.batchName[l(this).index()])&&(l("#select_batch").html(t.renderBatch(t.batchName[l(this).index()])),l("#select_batch button").first().addClass("active"),t.getSchoolByBatch(),t.addHandleBatch()))})},getEnroll:function(t){var a=this,n=e("batch");l.ajax({type:"get",url:"/university/getEnrollPlan.do",contentType:"application/x-www-form-urlencoded;charset=utf-8",data:{id:t,batch:n},dataType:"json",success:function(t){"0000000"===t.rtnCode&&a.renderEnroll(t.bizData)},error:function(t){}})},renderEnrollTable:function(t){var e=[];e.push('<table border="0" cellpadding="0" cellspacing="0"><thead><tr><th  class="name">专业名称</th><th>批次</th><th>科类</th><th>计划人数</th><th>学制</th><th>收费标准</th></tr></thead><tbody>');for(var a=0,l=t.length;l>a;a++)e.push('<tr><td width="50%" class="name">'+(t[a].majoredName||"")+'</td><td width="10%">'+(t[a].batch||"")+'</td><td width="10%">'+(t[a].subject||"")+'</td><td width="10%">'+(t[a].planNumber||"")+'</td><td width="10%">'+(t[a].schoolLength||"")+'</td><td width="10%">'+(t[a].feeStandard||"")+"</td></tr>");return e.push("</tbody></table>"),e.join("")},renderEnroll:function(t){for(var e=t.enrollPlan,a=[],n=[],i=0,s=e.length;s>i;i++){var o="enrollData"+i;a.push('<li data-saveData="'+o+'">'+e[i].title+"</li>");var r=e[i].planInfos;this[o]=r,n.push('<div style="display:none" class="school-table mt20" id="enroll_table_'+i+'">'),n.push(this.renderEnrollTable(r)),n.push("</div>")}a.push("<li>招生章程</li>"),n.push('<div style="display:none" class="school-table mt20" id="enroll_table_'+i+'">'+(t.entroIntro||"")+"</div>"),i++,a.push("<li>院校简介</li>"),n.push('<div style="display:none" class="school-table mt20" id="enroll_table_'+i+'">'+(t.universityIntro||"")+"</div>"),l("#tabs_list_enroll").html(a.join("")),l("#enroll_content").html(n.join("")),l("#tabs_list_enroll li").first().addClass("active");var c=l("#tabs_list_enroll li.active").text();this.setCategory(c),l("#enroll_table_0").show(),this.addEnrollEventHandle(),this.categoryHandle()},addEnrollEventHandle:function(){var t=this;l("#tabs_list_enroll li").on("mouseover",function(){if(!l(this).hasClass("fr")&&!l(this).hasClass("active")){l(this).addClass("active").siblings().removeClass("active");var e=l(this).text(),a=l(this).index();t.setCategory(e,l(this)),l("#enroll_table_"+a).show().siblings().hide()}})},setCategory:function(t,e){if("招生章程"===t||"院校简介"===t)l("#category").hide();else{if(l("#category button").removeClass("active"),e){var a=e.attr("data-categoryId");a&&l('#category button[data-id="'+a+'"]').addClass("active")}l("#category").show()}},categoryHandle:function(){var t=this;l("#category button").on("click",function(e){l(this).addClass("active").siblings().removeClass("active"),l("#tabs_list_enroll li.active").attr("data-categoryId",l(this).attr("data-id"));var a=l(this).text();t.filterEnroll(a,l("#tabs_list_enroll li.active").index())})},filterEnroll:function(t,e){for(var a=this["enrollData"+e],n=[],i=0;i<a.length;i++)t===a[i].subject&&n.push(a[i]);n.length>0?l("#enroll_table_"+e).html(this.renderEnrollTable(n)):l("#enroll_table_"+e).html('<p style="padding: 20px 0; text-align: center">没有符合相关的信息！</p>')}};l(document).ready(function(){var t=e("code"),a=e("id");t?n.getBasicInfo("code",t):a&&n.getBasicInfo("id",a)})});