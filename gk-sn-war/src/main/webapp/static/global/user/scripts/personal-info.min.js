define(function(t){function e(t){a(".error-tips").text(t).fadeIn(1e3).fadeOut(1e3)}function n(t){var e=new Date;return e.setFullYear(t.substring(0,4)),e.setMonth(t.substring(5,7)-1),e.setDate(t.substring(8,10)),e.setHours(t.substring(11,13)),e.setMinutes(t.substring(14,16)),e.setSeconds(t.substring(17,19)),Date.parse(e)/1e3}var a=t("$");t("laydate");var i=t("getTimes");a.get("/vip/getAccount.do",function(t){console.log(t);var e=t.bizData.account;"0000000"==t.rtnCode?e&&a("#account-tel").text(e):console.log(t.msg)}),a.get("/info/getUserInfo.do?"+(new Date).getTime(),function(t){if(console.log(t),"0000000"==t.rtnCode){var e=t.bizData,n="";n=""==e.icon||null==e.icon?"http://cdn.gaokao360.net/static/global/common/images/icon_default.png":e.icon,a("#avatar-img").attr("src",n),a("#userName").val(e.name),a("#school").val(e.schoolName),a("#birthdayDate").val(e.birthdayDate?i.getTime(e.birthdayDate,"yyyy-MM-dd"):"1970-01-01"),a('input[name="sex"][value="'+e.sex+'"]').attr("checked",!0),a('input[name="subject"][value="'+e.subjectType+'"]').attr("checked",!0),a("#email").val(e.mail),a("#qq").val(e.qq),r.init(e),r.addEventForArea()}});var r={data:[],init:function(t){var e=this;a.get("/region/getAllRegion.do",function(n){"0000000"===n.rtnCode&&(e.data=n.bizData,a("#cmbProvince").html(e.render(e.data,!0)),t.provinceId&&(a("#cmbProvince").val(t.provinceId),e.changeProvince(t.provinceId),a("#cmbCity").val(t.cityId),e.changeCity(t.cityId),a("#cmbArea").val(t.countyId)))})},render:function(t,e){var n=[];return e&&n.push("<option>请选择...</option>"),a.each(t,function(t,e){n.push('<option value="'+e.id+'">'+e.name+"</option>")}),n.join("")},changeProvince:function(t){if(t){var e=this.getCity(t);e&&e.length>0?(a("#cmbCity").html(this.render(e)),this.changeCity(e[0].id)):a("#cmbCity").html("<option>请选择...</option>")}},changeCity:function(t){var e=a("#cmbProvince").val();if(t&&e){var n=this.getCounty(e,t);n&&n.length>0?a("#cmbArea").html(this.render(n)):a("#cmbArea").html("<option>请选择...</option>")}},addEventForArea:function(){var t=this;a("#cmbProvince").change(function(e){var n=this.value;t.changeProvince(n)}),a("#cmbCity").change(function(e){var n=this.value;t.changeCity(n)})},getCity:function(t){for(var e=0,n=this.data.length;n>e;e++)if(this.data[e].id==t)return this.data[e].cityList},getCounty:function(t,e){for(var n=0,a=this.data.length;a>n;n++)if(this.data[n].id==t){var i=this.data[n].cityList;if(i.length<=0)return null;for(var r=0,o=i.length;o>r;r++)if(i[r].id==e)return i[r].countyList}}};a("#btn-submit").click(function(){var t=a('input[name="sex"]:checked').val(),i=a('input[name="subject"]:checked').val(),r=a.trim(a("#school").val()),o=a.trim(a("#birthdayDate").val()),c=n(o),s=a.trim(a("#userName").val());if(0==s.length)return e("用户名不能为空"),!1;if(s.length>10)return e("用户名不能大于10个字"),!1;if(0==r.length)return e("学校名不能为空"),!1;if(r.length>20)return e("学校名不能大于20个字"),!1;var l=a.trim(a("#qq").val()),u=a.trim(a("#email").val());if(0!=l.length||0!=u.length){var d=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;if(!d.test(u))return e("邮箱填写有误"),!1;var v=/^\s*[.0-9]{5,11}\s*$/;if(!v.test(l)||l.length>20)return a(".error-tips").text("QQ号码输入有误").fadeIn(),!1}var h=a("#avatar-img ").attr("src"),g=a("#cmbProvince").val(),m=a("#cmbCity").val(),f=a("#cmbArea").val();a.ajax({url:"/info/updateUserInfo.do",type:"POST",dataType:"json",data:{name:s,provinceId:g,cityId:m,countyId:f,schoolName:r,sex:t,birthdayDate:c,subjectType:i,mail:u,icon:h,qq:l},success:function(t){console.log(t),"0000000"==t.rtnCode?(a(".error-tips").text("信息更新成功").fadeIn(1e3).fadeOut(2e3),window.location.href="/user/personal-info.jsp"):a(".content").text(t.msg)}})})});