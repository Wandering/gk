define(function(t){function e(t){$(".error-tips").text(t).fadeIn(1e3).fadeOut(1e3)}function a(t){var e=new Date;return e.setTime(t),e.Format("yyyy-MM-dd")}t("$"),t("laydate"),Date.prototype.Format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in e)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[a]:("00"+e[a]).substr((""+e[a]).length)));return t},$.get("/vip/getAccount.do",function(t){"0000000"==t.rtnCode?$(".account-tel").text(t.bizData.account):console.log(t.msg)}),$.get("/info/getUserInfo.do",function(t){if("0000000"==t.rtnCode){var e,i=t.bizData;e=""==i.icon||null==i.icon?"http://cdn.gaokao360.net/static/global/common/images/icon_default.png":i.icon,console.log(t),$(".avatar-img").attr("src",e),$(".avatar-box").show(),$(".name").attr("value",i.name),$(".school").attr("value",i.schoolName),$(".birthdayDate").attr("value",i.birthdayDate?a(i.birthdayDate):"1970-01-01"),$(".sex").attr("value",i.sex),$(".subject").attr("value",i.subjectType),$(".mail").attr("value",i.mail),$(".qq").attr("value",i.qq),1==i.sex?$("#sex_m").attr("checked",!0):$("#sex_w").attr("checked",!0),1==i.subjectType?$("#subject_l").attr("checked",!0):$("#subject_w").attr("checked",!0),n.init(i),n.addEventForArea()}else alert(t.msg)}),$(".content").fadeIn();var n={data:[],init:function(t){var e=this;$.get("/region/getAllRegion.do",function(a){"0000000"===a.rtnCode&&(e.data=a.bizData,$("#cmbProvince").html(e.render(e.data,!0)),t.provinceId&&($("#cmbProvince").val(t.provinceId),e.changeProvince(t.provinceId),$("#cmbCity").val(t.cityId),e.changeCity(t.cityId),$("#cmbArea").val(t.countyId)))})},render:function(t,e){var a=[];return e&&a.push("<option>请选择...</option>"),$.each(t,function(t,e){a.push('<option value="'+e.id+'">'+e.name+"</option>")}),a.join("")},changeProvince:function(t){if(t){var e=this.getCity(t);e&&e.length>0?($("#cmbCity").html(this.render(e)),this.changeCity(e[0].id)):$("#cmbCity").html("<option>请选择...</option>")}},changeCity:function(t){var e=$("#cmbProvince").val();if(t&&e){var a=this.getCounty(e,t);a&&a.length>0?$("#cmbArea").html(this.render(a)):$("#cmbArea").html("<option>请选择...</option>")}},addEventForArea:function(){var t=this;$("#cmbProvince").change(function(e){var a=this.value;t.changeProvince(a)}),$("#cmbCity").change(function(e){var a=this.value;t.changeCity(a)})},getCity:function(t){for(var e=0,a=this.data.length;a>e;e++)if(this.data[e].id==t)return this.data[e].cityList},getCounty:function(t,e){for(var a=0,n=this.data.length;n>a;a++)if(this.data[a].id==t){var i=this.data[a].cityList;if(i.length<=0)return null;for(var r=0,o=i.length;o>r;r++)if(i[r].id==e)return i[r].countyList}}};$(".btn-submit").click(function(){var t=$('input[name="sex"]:checked').val(),a=$('input[name="subject"]:checked').val(),n=$(".school").val().trim(),i=$(".birthdayDate").val().trim(),r=Date.parse(new Date(i))/1e3,o=$(".name").val().trim();if(0==o.length)return e("用户名不能为空"),!1;if(o.length>10)return e("用户名不能大于10个字"),!1;if(0==n.length)return e("学校名不能为空"),!1;if(n.length>20)return e("学校名不能大于20个字"),!1;var c=$(".qq").val().trim(),s=$(".mail").val().trim();if(0!=c.length||0!=s.length){var l=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;if(!l.test(s))return e("邮箱填写有误"),!1;var h=/^\s*[.0-9]{5,11}\s*$/;if(!h.test(c)||c.length>20)return $(".error-tips").text("QQ号码输入有误").fadeIn(),!1}var u=$(".avatar-img ").attr("src");$.ajax({url:"/info/updateUserInfo.do",dataType:"json",type:"post",data:{name:o,provinceId:$("#cmbProvince").val(),cityId:$("#cmbCity").val(),countyId:$("#cmbArea").val(),schoolName:n,sex:t,birthdayDate:r,subjectType:a,mail:s,icon:u,qq:c},success:function(t){console.log(t),"0000000"==t.rtnCode?($(".user-avatar").attr("src",u),$(".error-tips").text("信息更新成功").fadeIn(1e3).fadeOut(2e3),window.location.href="/user/personal-info.jsp"):$(".content").text(t.msg)}})})});