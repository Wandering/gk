define(function(a){function e(){t(".content").css({height:"auto"}),t(".loader").hide(),t(".w1000").show()}var t=a("$"),s=function(a,e){var t,s=new RegExp("(^|)"+e+"=([^&]*)(&|$)","g").exec(a);return(t=s)?t[2]:""},r={curPage:1,totalPage:0,data:[],years:[],render:function(){this.renderCommon("batch",this.data),this.renderCommon("classify",this.getClassify()),this.renderCommon("year",this.getYear()),this.addHandleYear(),this.addEventHandle(),this.addEventForClassify(),this.getProfession(1),e()},getYear:function(){for(var a=this.years,e=[],t=0;t<a.length;t++)e.push({id:a[t],name:a[t]});return e},addHandleYear:function(){var a=this;t("#year a").on("click",function(e){a.curPage=1,t(this).addClass("active").siblings().removeClass("active"),a.getProfession(1)})},getClassify:function(a){for(var e=0,t=this.data.length,s={};t>e;e++)if(a){if(a==this.data[e].id)return this.data[e].subjectType}else for(var r=this.data[e].subjectType,i=0,n=r.length;n>i;i++)s[r[i].id]=r[i].name;var o=[];for(var c in s)o.push({id:c,name:s[c]});return o},getProfessionData:function(a){t("#batch a.active").attr("data-id");if(!a)return[];for(var e=0;e<this.data.length;e++)for(var s=this.data[e].subjectType,r=0;r<s.length;r++)if(a==s[r].id)return s[r].majoredType;return[]},renderCommon:function(a,e){var s=[],r=0,i=e.length;for(s.push('<a class="both active">全部</a>');i>r;r++)s.push('<a data-id="'+e[r].id+'">'+e[r].name+"</a>");t("#"+a).html(s.join(""))},addEventForClassify:function(){var a=this;t("#classify a").on("click",function(e){a.curPage=1,t(this).addClass("active").siblings().removeClass("active");var s=t(this).attr("data-id");s?t("#profession_content").show():(t("#profession").html(""),t("#profession_content").hide());var r=a.getProfessionData(s);r&&r.length>0?(a.renderCommon("profession",r),a.addEventForProfession()):(t("#profession").html(""),t("#profession_content").hide()),a.getProfession(1)})},addEventHandle:function(){var a=this;t("#batch a").on("click",function(e){a.curPage=1,t(this).addClass("active").siblings().removeClass("active");var s=t(this).attr("data-id");t("#profession").html(""),t("#profession_content").hide(),a.renderCommon("classify",a.getClassify(s)),a.addEventForClassify(),a.getProfession(1)})},addEventForProfession:function(){var a=this;t("#profession a").on("click",function(e){a.curPage=1,t(this).addClass("active").siblings().removeClass("active"),a.getProfession(1)})},getOptions:function(){var a=this;t.get("/majored/getInitInfo.do",function(e){"0000000"===e.rtnCode&&e.bizData.batchType&&(a.data=e.bizData.batchType,a.years=e.bizData.years,a.render())})},getProfession:function(e){var s=t("#batch a.active").attr("data-id"),r=t("#batch a.active").text();"全部"===r&&(r="");var i=t("#classify a.active").attr("data-id"),n=t("#classify a.active").text();"全部"===n&&(n="");var o=t("#profession a.active"),c="",d="";o[0]&&(c=o.attr("data-id"),d=o.text(),"全部"===d&&(d=""));var h=t("#search").val(),l=t("#year a.active").attr("data-id")||"",g=this;t.ajax({type:"get",url:"/majored/searchMajored.do",contentType:"application/x-www-form-urlencoded;charset=utf-8",data:{batchTypeId:s,batchTypeName:r,subjectTypeId:i,subjectTypeName:n,majoredTypeId:c,majoredTypeName:d,year:l,pageSize:10,pageNo:e,searchName:h},dataType:"json",success:function(e){if(console.log(e),"0000000"===e.rtnCode){var s=e.bizData;if(s&&s.length>0)g.renderProfessionList(s);else{var r=a("pageErrorTip");t("#profession_list").html(r("暂无相关数据")),t("#page").html(""),t(".record").html("")}}},error:function(a){}}),t.ajax({type:"get",url:"/majored/searchMajoredCount.do",contentType:"application/x-www-form-urlencoded;charset=utf-8",data:{batchTypeId:s,batchTypeName:r,subjectTypeId:i,subjectTypeName:n,majoredTypeId:c,majoredTypeName:d,year:l,pageSize:10,pageNo:e,searchName:h},dataType:"json",success:function(a){"0000000"===a.rtnCode&&1==e&&g.renderPage(1,a.bizData)},error:function(a){}})},renderProfessionList:function(a){var e=[],s=0,r=a.length;for(console.log(a),e.push('<table border="0" cellpadding="0" cellspacing="0"><thead><tr><th class="name">专业名称</th><th>计划人数</th><th>学制</th><th>外语语种</th><th>收费标准</th><th>开设院校</th></tr></thead><tbody>');r>s;s++){var i=s%2!=0?"active":"";e.push('<tr class="'+i+'"><td class="name"><a style="color: #555" href="/consult/profession_detail.jsp?id='+a[s].majoredId+'">'+(a[s].name||"")+"</a></td><td>"+(a[s].planNumber||"")+"</td><td>"+(a[s].schoolLength||"")+"</td><td>"+(a[s].foreginLanguage||"")+"</td><td>"+(a[s].feeStandard||"")+'</td><td><a target="_blank" href="/consult/school_detail.jsp?id='+a[s].universityId+'">'+(a[s].universityName||"")+"</a></td></tr>")}e.push("</tbody></table>"),t("#profession_list").html(e.join(""))},renderPage:function(a,e){this.totalPage=Math.ceil(e/10);var s=[],r=10*(a-1)+1;t(".record").html("共"+e+"条记录&nbsp;&nbsp;共"+this.totalPage+'页&nbsp;&nbsp;<span class="startNum">'+r+"</span>/"+e),s.push('<a class="previous-page">上一页</a>');for(var i=this.totalPage>10?10:this.totalPage,n=0;i>n;n++){var o=n+1;a==o?s.push('<a class="active '+o+'">'+o+"</a>"):s.push('<a class="'+o+'">'+o+"</a>")}i!=this.totalPage&&s.push("<span>...</span>"),s.push('<a class="next-page">下一页</a>'),t("#page").html(s.join("")),this.pageEventHandle()},refreshPageShow:function(a){var e=a+2;e=e>this.totalPage?this.totalPage:e;var t=this.totalPage>10?10:this.totalPage;e=t>e?t:e;for(var s=e,r=[],i=0;10>i;i++)r.push(e--);return r.reverse(),s>10&&(r[0]=1,r[1]=2,r[2]="..."),s<=this.totalPage-2&&r.push("..."),r},refreshPage:function(a){var e=this.refreshPageShow(a),s=[];s.push('<a class="previous-page">上一页</a>');for(var r=0;r<e.length;r++)"string"==typeof e[r]?s.push("<span>...</span>"):s.push('<a class="'+e[r]+'">'+e[r]+"</a>");s.push('<a class="next-page">下一页</a>'),t("#page").html(s.join("")),this.pageEventHandle()},pageEventHandle:function(){var a=this;t("#page a").on("click",function(e){if(t(this).hasClass("previous-page")){if(a.curPage>1&&a.curPage--,a.curPage>0){!t("#page a."+a.curPage)[0]&&a.totalPage>10&&a.refreshPage(a.curPage),t("#page a."+a.curPage).addClass("active").siblings().removeClass("active");var s=10*(a.curPage-1)+1;t(".startNum").text(s),a.getProfession(a.curPage)}}else if(t(this).hasClass("next-page")){if(a.curPage<a.totalPage&&a.curPage++,a.curPage<=a.totalPage){!t("#page a."+a.curPage)[0]&&a.totalPage>10&&a.refreshPage(a.curPage),t("#page a."+a.curPage).addClass("active").siblings().removeClass("active");var s=10*(a.curPage-1)+1;t(".startNum").text(s),a.getProfession(a.curPage)}}else if(!t(this).hasClass("active")){if(a.curPage=parseInt(t(this).text()),t(this).addClass("active").siblings().removeClass("active"),a.totalPage>10){var r=a.curPage+1,i=a.curPage-1;r<=a.totalPage&&i>0&&(t("#page a."+r)[0]&&t("#page a."+i)[0]||(a.refreshPage(a.curPage),t("#page a."+a.curPage).addClass("active")))}if(a.curPage>0&&a.curPage<=a.totalPage){var s=10*(a.curPage-1)+1;t(".startNum").text(s),a.getProfession(a.curPage)}}})},getSearch:function(){this.curPage=1,this.getProfession(1)}};t(document).ready(function(){r.getOptions();var a=decodeURIComponent(s(window.location.href,"val"));a&&t("#search").val(a),t("#search_button").on("click",function(){var a=t("#search").val();a&&r.getSearch()}),t("#search").keydown(function(a){if(13==a.keyCode){var e=t("#search").val();e&&r.getSearch()}})})});