define(function(a){function t(){e(".content").css({height:"auto"}),e(".loader").hide(),e(".w1000").show()}var e=a("$"),s=a("pageErrorTip"),i={curPage:1,totalPage:0,render:function(a,t){var s=[],i=0,r=t.length;for("universityFeature"!==a&&s.push('<a class="active" id="0">全部</a>');r>i;i++)s.push('<a id="'+t[i].id+'">'+t[i].name+"</a>");e("#"+a).html(s.join(""))},show:function(a,t){this.render(a,t),this.addEventForOption()},getData:function(){var a=this;e.get("/university/getInitInfo.do",function(t){"0000000"===t.rtnCode&&(e.each(["provinces","universityType","universityBatch","universityFeature"],function(e,s){a.show(s,t.bizData[s])}),a.getSchoolList(1))})},addEventForOption:function(){var a=this;e(".options a").on("click",function(t){var s=e(this).parent().attr("id");a.curPage=1,"universityFeature"===s?(e(this).toggleClass("active"),a.getSchoolList(1)):(e(this).hasClass("active")||e(this).addClass("active").siblings().removeClass("active"),a.getSchoolList(1))})},renderSchool:function(a){console.log(a[0].id);var s=[],i=0,r=a.length;for(s.push('<table border="0" cellpadding="0" cellspacing="0"><thead><tr><th class="name">院校名称</th><th>所在地区</th><th>院校类型</th><th>院校隶属</th><th>院校特征</th><th>院校信息</th></tr></thead><tbody>');r>i;i++){var c=i%2!=0?"active":"";s.push('<tr class="'+c+'"><td class="name">'+(a[i].name||"")+"</td><td>"+(a[i].provinceName||"")+"</td><td>"+(a[i].universityType||"")+"</td><td>"+(a[i].subjection||"")+"</td><td>"+(a[i].property||"")+'</td><td><a target="_blank" href="/consult/school_detail.jsp?id='+a[i].id+'">查看详情</a></td></tr>')}s.push("</tbody></table>"),e("#school_list").html(s.join("")),t()},getSchoolList:function(a){var t=e("#provinces a.active").attr("id"),i=e("#provinces a.active").text();"全部"===i&&(i="");var r=e("#universityType a.active").attr("id"),c=e("#universityType a.active").text();"全部"===c&&(c="");var n=e("#universityBatch a.active").attr("id"),o=e("#universityBatch a.active").text();"全部"===o&&(o="");var h=[];e.each(e("#universityFeature a.active"),function(a,t){h.push(e(t).attr("id"))});var u=h.join(",")||0,g=[];e.each(e("#universityFeature a.active"),function(a,t){g.push(e(t).text())});var l=g.join(","),v=e("#school_serach").val(),p=this;e.ajax({type:"get",url:"/university/getUniversityList.do",contentType:"application/x-www-form-urlencoded;charset=utf-8",data:{provinceId:t,provinceName:i,universityTypeId:r,universityTypeName:c,universityBatchId:n,universityBatchName:o,universityFeatureId:u,universityFeatureName:l,pageSize:10,pageNo:a,searchName:v},dataType:"json",success:function(t){if("0000000"===t.rtnCode){var i=t.bizData.list;i&&i.length?(p.renderSchool(i),1==a&&p.renderPage(1,t.bizData.count)):(e("#school_list").html(s("暂无相关数据")),e("#page").html(""),e(".record").html(""))}},error:function(a){}})},renderPage:function(a,t){this.totalPage=Math.ceil(t/10);var s=[],i=10*(a-1)+1;e(".record").html("共"+t+"条记录&nbsp;&nbsp;共"+this.totalPage+'页&nbsp;&nbsp;<span class="startNum">'+i+"</span>/"+t),s.push('<a class="previous-page">上一页</a>');for(var r=this.totalPage>10?10:this.totalPage,c=0;r>c;c++){var n=c+1;a==n?s.push('<a class="active '+n+'">'+n+"</a>"):s.push('<a class="'+n+'">'+n+"</a>")}r!=this.totalPage&&s.push("<span>...</span>"),s.push('<a class="next-page">下一页</a>'),e("#page").html(s.join("")),this.pageEventHandle()},refreshPageShow:function(a){var t=a+2;t=t>this.totalPage?this.totalPage:t;var e=this.totalPage>10?10:this.totalPage;t=e>t?e:t;for(var s=t,i=[],r=0;10>r;r++)i.push(t--);return i.reverse(),s>10&&(i[0]=1,i[1]=2,i[2]="..."),s<=this.totalPage-2&&i.push("..."),i},refreshPage:function(a){var t=this.refreshPageShow(a),s=[];s.push('<a class="previous-page">上一页</a>');for(var i=0;i<t.length;i++)"string"==typeof t[i]?s.push("<span>...</span>"):s.push('<a class="'+t[i]+'">'+t[i]+"</a>");s.push('<a class="next-page">下一页</a>'),e("#page").html(s.join("")),this.pageEventHandle()},pageEventHandle:function(){var a=this;e("#page a").off("click"),e("#page a").on("click",function(t){if(e(this).hasClass("previous-page")){if(a.curPage>1&&a.curPage--,a.curPage>0){!e("#page a."+a.curPage)[0]&&a.totalPage>10&&a.refreshPage(a.curPage),e("#page a."+a.curPage).addClass("active").siblings().removeClass("active");var s=10*(a.curPage-1)+1;e(".startNum").text(s),a.getSchoolList(a.curPage)}}else if(e(this).hasClass("next-page")){if(a.curPage<a.totalPage&&a.curPage++,a.curPage<=a.totalPage){!e("#page a."+a.curPage)[0]&&a.totalPage>10&&a.refreshPage(a.curPage),e("#page a."+a.curPage).addClass("active").siblings().removeClass("active");var s=10*(a.curPage-1)+1;e(".startNum").text(s),a.getSchoolList(a.curPage)}}else if(!e(this).hasClass("active")){if(a.curPage=parseInt(e(this).text()),e(this).addClass("active").siblings().removeClass("active"),a.totalPage>10){var i=a.curPage+1,r=a.curPage-1;i<=a.totalPage&&r>0&&(e("#page a."+i)[0]&&e("#page a."+r)[0]||(a.refreshPage(a.curPage),e("#page a."+a.curPage).addClass("active")))}if(a.curPage>0&&a.curPage<=a.totalPage){var s=10*(a.curPage-1)+1;e(".startNum").text(s),a.getSchoolList(a.curPage)}}})},getSearch:function(){this.curPage=1,this.getSchoolList(1)}};e(document).ready(function(){i.getData(),e("#search_button").on("click",function(a){var t=e("#school_serach").val();t&&i.getSearch()}),e("#school_serach").keydown(function(a){if(13==a.keyCode){var t=e("#school_serach").val();t&&i.getSearch()}})})});