<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.thinkjoy.gk.dao.IForecastDAO">

    <!--查询专业大类-->
    <select id="getMajoredCategory" resultType="java.util.Map">
        SELECT
        discipline_code,discipline_name
        from zgk_major_base
        <where>
            <if test="majorType!=null">
                major_type = #{majorType}
            </if>
        </where>
        GROUP BY discipline_code
    </select>

    <!--根据大类ID查询专业小类-->
    <select id="getCategoryMajoredList" resultType="java.util.Map">
        SELECT
        discipline_sub_code,
        discipline_sub_name
        from zgk_major_base
        WHERE discipline_code=#{categoryId}
        GROUP BY discipline_sub_code
    </select>

    <!--根据专业名称和专业类型(1文史2理工)查找专业-->
    <select id="getMajoredByName" resultType="java.util.Map">
        select
         discipline_name as disciplineCategoriesName,
          discipline_sub_name as majorCategoryName,
          major_name as majoredName,
          id as majoredId
        from zgk_major_base
        WHERE
        major_name like CONCAT('%',#{majoredName},'%')
        AND major_type = #{majorType}
    </select>

    <!--根据专业ID查询专业信息-->
    <!--查询内容有:专业Id、专业名称、就业率、薪资、专业代码、授予学位、修学年限、开设课程、专业解读-->
    <select id="getMajoredInfoById" resultType="java.util.Map">
        select
        aa.id,
        major_name as majorName,
        aa.major_code as majorCode,
	    degree_offered as degreeOffered,
        schooling_duration as schoolingDuration,
        offer_courses as offerCourses,
        major_introduce as majorIntroduce,
        employmentRate,
        salary_rank as salary
        from zgk_major_base aa INNER JOIN zgk_major_detail bb ON aa.id=bb.id
        WHERE
        major_name like CONCAT('%',#{majoredName},'%')
        AND major_type = #{majorType}
    </select>


    <!--根据查询专业对哪些院校开放-->
    <select id="getMajorOpenUniversityList" resultType="java.util.Map">
        SELECT
        university.id as id ,
        university.name as name ,
        university.subjection as subjection ,
        university.photo_url as photoUrl ,
        university.property as property ,
        leveldict.name as levelName,
        university.rank as rank ,
        typedict.name as typeName,
        province.name as province,
        university.lastModifier as lastModifier
        FROM
        zgk_university university
        LEFT JOIN zgk_province province ON province.id = university.areaid
        LEFT JOIN zgk_data_dict typedict ON typedict.dictId=university.type AND typedict.type='UNIVERSITY_TYPE'
        LEFT JOIN zgk_data_dict leveldict ON leveldict.dictId = university.educationLevel AND leveldict.type='EDULEVEL'
        where
        university.id in (SELECT
        universityId
        FROM
        zgk_university_major_base mm
        WHERE
        major_code = (SELECT major_code from zgk_major_base where id=#{condition.majorId}) )
        ORDER BY university.lastModifier DESC
        <if test="offset != null">
            limit ${offset}, ${rows}
        </if>
    </select>
    <select id="getMajorOpenUniversityCount" parameterType="java.util.Map" resultType="java.lang.Integer">
        select count(*)
        from zgk_university uu
        left join zgk_university_major_base mm on uu.id=mm.universityId
        where mm.majorId=#{condition.majorId}
        and mm.educationLevel=#{condition.educationLevel}
    </select>

</mapper>

